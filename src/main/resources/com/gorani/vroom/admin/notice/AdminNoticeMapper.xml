<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gorani.vroom.admin.notice.AdminNoticeMapper">


    <!--공지 목록 조회-->
    <select id="getNoticeList"
            resultType="com.gorani.vroom.admin.notice.NoticeVO">
        SELECT id, title, content, target, status, is_important, start_at,
        end_at, created_at, updated_at, admin_id
        FROM NOTICES
        <where>
            <if test="keyword != null and keyword != ''">
                AND (title LIKE CONCAT('%', #{keyword}, '%') OR id =
                #{keyword})
            </if>
            <if test="status != null and status != ''">
                AND status = #{status}
            </if>
            <if test="target != null and target != ''">
                AND target = #{target}
            </if>
        </where>
        ORDER BY is_important DESC, created_at DESC
    </select>


    <!--공지 상세 조회-->
    <select id="getNoticeById"
            resultType="com.gorani.vroom.admin.notice.NoticeVO">
        SELECT id, title, content, target, status, is_important, start_at,
               end_at, created_at, updated_at, admin_id
        FROM NOTICES
        WHERE id = #{id}
    </select>


    <!--공지 등록-->
    <insert id="insertNotice"
            parameterType="com.gorani.vroom.admin.notice.NoticeVO">
        INSERT INTO NOTICES (title, content, target, status, is_important,
                             start_at, end_at, admin_id)
        VALUES (#{title}, #{content}, #{target}, #{status}, #{isImportant},
                #{startAt}, #{endAt}, #{adminId})
    </insert>


    <!--공지 수정-->
    <update id="updateNotice"
            parameterType="com.gorani.vroom.admin.notice.NoticeVO">
        UPDATE NOTICES
        SET title = #{title},
            content = #{content},
            target = #{target},
            status = #{status},
            is_important = #{isImportant},
            start_at = #{startAt},
            end_at = #{endAt},
            updated_at = CURRENT_TIMESTAMP
        WHERE id = #{id}
    </update>


    <!--공지 삭제-->
    <delete id="deleteNotice">
        DELETE FROM NOTICES WHERE id = #{id}
    </delete>

</mapper>